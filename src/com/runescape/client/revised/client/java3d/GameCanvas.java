/**
 * Eclipse Public License - v 1.0
 *
 * THE ACCOMPANYING PROGRAM IS PROVIDED UNDER THE TERMS OF THIS ECLIPSE PUBLIC LICENSE ("AGREEMENT"). ANY USE, REPRODUCTION OR DISTRIBUTION
 * OF THE
 * PROGRAM CONSTITUTES RECIPIENT'S ACCEPTANCE OF THIS AGREEMENT.
 * 
 * 1. DEFINITIONS
 * 
 * "Contribution" means:
 * 
 * a) in the case of the initial Contributor, the initial code and documentation distributed under this Agreement, and
 * b) in the case of each subsequent Contributor:
 * i) changes to the Program, and
 * ii) additions to the Program;
 * where such changes and/or additions to the Program originate from and are distributed by that particular Contributor. A Contribution
 * 'originates' from a Contributor if it was added to the Program by such Contributor itself or anyone acting on such Contributor's behalf.
 * Contributions do not include additions to the Program which: (i) are separate modules of software distributed in conjunction with the Program
 * under their own license agreement, and (ii) are not derivative works of the Program.
 * "Contributor" means any person or entity that distributes the Program.
 * 
 * "Licensed Patents" mean patent claims licensable by a Contributor which are necessarily infringed by the use or sale of its Contribution alone
 * or when combined with the Program.
 * 
 * "Program" means the Contributions distributed in accordance with this Agreement.
 * 
 * "Recipient" means anyone who receives the Program under this Agreement, including all Contributors.
 * 
 * 2. GRANT OF RIGHTS
 * 
 * a) Subject to the terms of this Agreement, each Contributor hereby grants Recipient a non-exclusive, worldwide, royalty-free copyright license
 * to reproduce, prepare derivative works of, publicly display, publicly perform, distribute and sublicense the Contribution of such Contributor,
 * if any, and such derivative works, in source code and object code form.
 * b) Subject to the terms of this Agreement, each Contributor hereby grants Recipient a non-exclusive, worldwide, royalty-free patent license
 * under Licensed Patents to make, use, sell, offer to sell, import and otherwise transfer the Contribution of such Contributor, if any, in source
 * code and object code form. This patent license shall apply to the combination of the Contribution and the Program if, at the time the
 * Contribution is added by the Contributor, such addition of the Contribution causes such combination to be covered by the Licensed Patents. The
 * patent license shall not apply to any other combinations which include the Contribution. No hardware per se is licensed hereunder.
 * c) Recipient understands that although each Contributor grants the licenses to its Contributions set forth herein, no assurances are provided
 * by any Contributor that the Program does not infringe the patent or other intellectual property rights of any other entity. Each Contributor
 * disclaims any liability to Recipient for claims brought by any other entity based on infringement of intellectual property rights or otherwise.
 * As a condition to exercising the rights and licenses granted hereunder, each Recipient hereby assumes sole responsibility to secure any other
 * intellectual property rights needed, if any. For example, if a third party patent license is required to allow Recipient to distribute the
 * Program, it is Recipient's responsibility to acquire that license before distributing the Program.
 * d) Each Contributor represents that to its knowledge it has sufficient copyright rights in its Contribution, if any, to grant the copyright
 * license set forth in this Agreement.
 * 3. REQUIREMENTS
 * 
 * A Contributor may choose to distribute the Program in object code form under its own license agreement, provided that:
 * 
 * a) it complies with the terms and conditions of this Agreement; and
 * b) its license agreement:
 * i) effectively disclaims on behalf of all Contributors all warranties and conditions, express and implied, including warranties or conditions
 * of title and non-infringement, and implied warranties or conditions of merchantability and fitness for a particular purpose;
 * ii) effectively excludes on behalf of all Contributors all liability for damages, including direct, indirect, special, incidental and
 * consequential damages, such as lost profits;
 * iii) states that any provisions which differ from this Agreement are offered by that Contributor alone and not by any other party; and
 * iv) states that source code for the Program is available from such Contributor, and informs licensees how to obtain it in a reasonable manner
 * on or through a medium customarily used for software exchange.
 * When the Program is made available in source code form:
 * 
 * a) it must be made available under this Agreement; and
 * b) a copy of this Agreement must be included with each copy of the Program.
 * Contributors may not remove or alter any copyright notices contained within the Program.
 * 
 * Each Contributor must identify itself as the originator of its Contribution, if any, in a manner that reasonably allows subsequent Recipients
 * to identify the originator of the Contribution.
 * 
 * 4. COMMERCIAL DISTRIBUTION
 * 
 * Commercial distributors of software may accept certain responsibilities with respect to end users, business partners and the like. While this
 * license is intended to facilitate the commercial use of the Program, the Contributor who includes the Program in a commercial product offering
 * should do so in a manner which does not create potential liability for other Contributors. Therefore, if a Contributor includes the Program in
 * a commercial product offering, such Contributor ("Commercial Contributor") hereby agrees to defend and indemnify every other Contributor
 * ("Indemnified Contributor") against any losses, damages and costs (collectively "Losses") arising from claims, lawsuits and other legal actions
 * brought by a third party against the Indemnified Contributor to the extent caused by the acts or omissions of such Commercial Contributor in
 * connection with its distribution of the Program in a commercial product offering. The obligations in this section do not apply to any claims or
 * Losses relating to any actual or alleged intellectual property infringement. In order to qualify, an Indemnified Contributor must: a) promptly
 * notify the Commercial Contributor in writing of such claim, and b) allow the Commercial Contributor to control, and cooperate with the
 * Commercial Contributor in, the defense and any related settlement negotiations. The Indemnified Contributor may participate in any such claim
 * at its own expense.
 * 
 * For example, a Contributor might include the Program in a commercial product offering, Product X. That Contributor is then a Commercial
 * Contributor. If that Commercial Contributor then makes performance claims, or offers warranties related to Product X, those performance claims
 * and warranties are such Commercial Contributor's responsibility alone. Under this section, the Commercial Contributor would have to defend
 * claims against the other Contributors related to those performance claims and warranties, and if a court requires any other Contributor to pay
 * any damages as a result, the Commercial Contributor must pay those damages.
 * 
 * 5. NO WARRANTY
 * 
 * EXCEPT AS EXPRESSLY SET FORTH IN THIS AGREEMENT, THE PROGRAM IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 * EITHER EXPRESS OR IMPLIED INCLUDING, WITHOUT LIMITATION, ANY WARRANTIES OR CONDITIONS OF TITLE, NON-INFRINGEMENT, MERCHANTABILITY OR FITNESS
 * FOR A PARTICULAR PURPOSE. Each Recipient is solely responsible for determining the appropriateness of using and distributing the Program and
 * assumes all risks associated with its exercise of rights under this Agreement , including but not limited to the risks and costs of program
 * errors, compliance with applicable laws, damage to or loss of data, programs or equipment, and unavailability or interruption of operations.
 * 
 * 6. DISCLAIMER OF LIABILITY
 * 
 * EXCEPT AS EXPRESSLY SET FORTH IN THIS AGREEMENT, NEITHER RECIPIENT NOR ANY CONTRIBUTORS SHALL HAVE ANY LIABILITY FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING WITHOUT LIMITATION LOST PROFITS), HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OR DISTRIBUTION
 * OF THE PROGRAM OR THE EXERCISE OF ANY RIGHTS GRANTED HEREUNDER, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.
 * 
 * 7. GENERAL
 * 
 * If any provision of this Agreement is invalid or unenforceable under applicable law, it shall not affect the validity or enforceability of the
 * remainder of the terms of this Agreement, and without further action by the parties hereto, such provision shall be reformed to the minimum
 * extent necessary to make such provision valid and enforceable.
 * 
 * If Recipient institutes patent litigation against any entity (including a cross-claim or counterclaim in a lawsuit) alleging that the Program
 * itself (excluding combinations of the Program with other software or hardware) infringes such Recipient's patent(s), then such Recipient's
 * rights granted under Section 2(b) shall terminate as of the date such litigation is filed.
 * 
 * All Recipient's rights under this Agreement shall terminate if it fails to comply with any of the material terms or conditions of this
 * Agreement and does not cure such failure in a reasonable period of time after becoming aware of such noncompliance. If all Recipient's rights
 * under this Agreement terminate, Recipient agrees to cease use and distribution of the Program as soon as reasonably practicable. However,
 * Recipient's obligations under this Agreement and any licenses granted by Recipient relating to the Program shall continue and survive.
 * 
 * Everyone is permitted to copy and distribute copies of this Agreement, but in order to avoid inconsistency the Agreement is copyrighted and may
 * only be modified in the following manner. The Agreement Steward reserves the right to publish new versions (including revisions) of this
 * Agreement from time to time. No one other than the Agreement Steward has the right to modify this Agreement. The Eclipse Foundation is the
 * initial Agreement Steward. The Eclipse Foundation may assign the responsibility to serve as the Agreement Steward to a suitable separate
 * entity. Each new version of the Agreement will be given a distinguishing version number. The Program (including Contributions) may always be
 * distributed subject to the version of the Agreement under which it was received. In addition, after a new version of the Agreement is
 * published, Contributor may elect to distribute the Program (including its Contributions) under the new version. Except as expressly stated in
 * Sections 2(a) and 2(b) above, Recipient receives no rights or licenses to the intellectual property of any Contributor under this Agreement,
 * whether expressly, by implication, estoppel or otherwise. All rights in the Program not expressly granted under this Agreement are reserved.
 * 
 * This Agreement is governed by the laws of the State of New York and the intellectual property laws of the United States of America. No party to
 * this Agreement will bring a legal action under this Agreement more than one year after the cause of action arose. Each party waives its rights
 * to a jury trial in any resulting litigation.
 */
package com.runescape.client.revised.client.java3d;

import java.awt.Graphics2D;

import javax.media.j3d.Canvas3D;

import com.runescape.client.revised.client.java3d.model.impl.Male;
import com.runescape.client.revised.media.chat.ChatBox;
import com.runescape.client.revised.media.map.Compass;
import com.runescape.client.revised.media.map.MapArea;
import com.runescape.client.revised.media.tabarea.TabArea;
import com.runescape.client.revised.media.threeduniverse.Memory;
import com.runescape.client.revised.media.threeduniverse.RevisionType;
import com.runescape.client.revised.model.entity.player.GamePlayer;
import com.sun.j3d.utils.universe.SimpleUniverse;

public class GameCanvas extends Canvas3D {

	private static final long serialVersionUID = 7158753061498064848L;
	private ChatBox chatBox;
	private TabArea tabArea;
	private Compass compass;
	private MapArea mapArea;
	private GamePlayer player;
	private boolean isRunning;
	private Memory memory;
	private RevisionType revisionType;
	private GameFrame gameFrame;
	private Male male;

	public GameCanvas(final GamePlayer player, final GameFrame gameFrame, final Male male) {
		super(SimpleUniverse.getPreferredConfiguration());
		this.setRunning(true);
		this.setPlayer(player);
		this.setGameFrame(gameFrame);
		this.setMale(male);
		this.setChatBox(this.getPlayer().getChatBoxSystem().getChatBox());
		this.setTabArea(this.getPlayer().getTabAreaSystem().getTabArea());
		this.setMapArea(this.getPlayer().getMapSystem().getMapArea());
		this.setCompass(this.getMapArea().getCompass());
		this.setSize(773, 531);
		this.addKeyListener(new GameCanvasKeyAdapter(this.getPlayer(), this.getMale()));
		final GameCanvasMouseAdapter gameCanvasMouseAdapter = new GameCanvasMouseAdapter(this.getPlayer(), (Graphics2D) this.getGraphics());
		this.addMouseListener(gameCanvasMouseAdapter);
		this.addMouseMotionListener(gameCanvasMouseAdapter);
		new Thread(new FPSThread()).start();
	}

	/** @Override
	public void postRender() {
		this.setMemory(Memory.LOW);
		this.setRevisionType(RevisionType.THREE_ONE_SEVEN);
		final Image scrollbarUp = this.getChatBox().getScrollbarUp().getImage();
		final short scrollbarUpX = this.getChatBox().getScrollbarUp().getLocation().getX();
		final short scrollbarUpY = this.getChatBox().getScrollbarUp().getLocation().getY();
		this.getGraphics2D().drawImage(scrollbarUp, scrollbarUpX, scrollbarUpY, null);
		final Image scrollbarDown = this.getChatBox().getScrollbarDown().getImage();
		final short scrollbarDownX = this.getChatBox().getScrollbarDown().getLocation().getX();
		final short scrollbarDownY = this.getChatBox().getScrollbarDown().getLocation().getY();
		this.getGraphics2D().drawImage(scrollbarDown, scrollbarDownX, scrollbarDownY, null);
		final short[] xLocation = {
				551, 574, 605, 637, 675, 704, 732, 575, 604, 637, 676, 706, 731
		};
		final short[] yLocation = {
				174, 173, 173, 171, 173, 173, 173, 469, 469, 470, 468, 468, 468
		};
		for (byte b = 0; b < 13; b++) {
			final Image tabIconImage = this.getTabArea().getTabs()[b].getTabIcon();
			this.getGraphics2D().drawImage(tabIconImage, xLocation[b], yLocation[b], null);
		}
		final short frameDuration = (short) this.getView().getLastFrameDuration();
		this.getGraphics2D().setColor(Color.WHITE);
		this.getGraphics2D().drawString("FPS: " + frameDuration, 10, 40);

		this.getGraphics2D().setColor(Color.BLACK);
		this.getGraphics2D().drawLine(18, 431, 495, 436);
		this.getGraphics2D().drawString("Welcome to RS3 Newstart.", 21, 427);
		final GamePlayer player = this.getPlayer();
		if (player.getUsername().equals("Josh")) {
			player.setRankType(RankType.ADMINISTRATOR);
			final Image adminImage = player.getRankType().getImage();
			final short adminIconX = 21;
			final short adminIconY = 437;
			this.getGraphics2D().drawImage(adminImage, adminIconX, adminIconY, null);
		}
		if (player.getUsername().equals("Josh")) {
			this.getGraphics2D().drawString(player.getUsername(), 36, 447);
		} else {
			this.getGraphics2D().drawString(player.getUsername(), 21, 447);
		}
		final short hoverX = this.getPlayer().getHoverX();
		final short hoverY = this.getPlayer().getHoverY();
		final short clickedX = this.getPlayer().getClickedX();
		final short clickedY = this.getPlayer().getClickedY();
		final boolean isChatBoxHovered = (hoverX >= 0) && (hoverX <= 519) && (hoverY >= 339) && (hoverY <= 504);
		final boolean isTabAreaHovered = (hoverX >= 519) && (hoverX <= 769) && (hoverY >= 167) && (hoverY <= 505);
		final boolean isMapAreaHovered = (hoverX >= 519) && (hoverX <= 769) && (hoverY >= -1) && (hoverY <= 168);

		//
		final StringBuilder xStringBuilder = new StringBuilder("X: ");
		xStringBuilder.append(hoverX);
		final StringBuilder yStringBuilder = new StringBuilder("Y: ");
		yStringBuilder.append(hoverY);
		this.getGraphics2D().setColor(Color.WHITE);
		this.getGraphics2D().drawString(xStringBuilder.toString(), 10, 60);
		this.getGraphics2D().drawString(yStringBuilder.toString(), 10, 80);
		//

		this.getGraphics2D().flush(true);
		final boolean isCombatTabClicked = (clickedX >= 539) && (clickedX <= 573) && (clickedY >= 169) && (clickedY < 205);
		final boolean isSkillTabClicked = (clickedX >= 569) && (clickedX <= 599) && (clickedY >= 168) && (clickedY < 205);
		final boolean isQuestTabClicked = (clickedX >= 597) && (clickedX <= 627) && (clickedY >= 168) && (clickedY < 205);
		final boolean isInventoryTabClicked = (clickedX >= 625) && (clickedX <= 669) && (clickedY >= 168) && (clickedY < 203);
		final boolean isArmourTabClicked = (clickedX >= 666) && (clickedX <= 696) && (clickedY >= 168) && (clickedY < 205);
		final boolean isPrayerTabClicked = (clickedX >= 694) && (clickedX <= 724) && (clickedY >= 168) && (clickedY < 205);
		final boolean isMagicTabClicked = (clickedX >= 722) && (clickedX <= 756) && (clickedY >= 169) && (clickedY < 205);
		final boolean isOtherTabClicked = (clickedX >= 540) && (clickedX <= 574) && (clickedY >= 466) && (clickedY < 502);
		final boolean isFriendTabClicked = (clickedX >= 572) && (clickedX <= 602) && (clickedY >= 466) && (clickedY < 503);
		final boolean isIgnoreTabClicked = (clickedX >= 599) && (clickedX <= 629) && (clickedY >= 466) && (clickedY < 503);
		final boolean isLogoutTabClicked = (clickedX >= 627) && (clickedX <= 671) && (clickedY >= 467) && (clickedY < 502);
		final boolean isSettingsTabClicked = (clickedX >= 669) && (clickedX <= 699) && (clickedY >= 466) && (clickedY < 503);
		final boolean isRunTabClicked = (clickedX >= 696) && (clickedX <= 726) && (clickedY >= 466) && (clickedY < 503);
		final boolean isMusicTabClicked =  (clickedX >= 724) && (clickedX <= 758) && (clickedY >= 466) && (clickedY < 502);
		switch (this.getPlayer().getMouseActionType()) {
		case LEFT_CLICK:
			final TabArea tabArea = this.getTabArea();
			switch (this.getPlayer().getTabType()) {
			case COMBAT:
				if (isCombatTabClicked) {
					final Image combatRedStone = tabArea.getTabs()[0].getImage();
					this.getGraphics2D().drawImage(combatRedStone, 539, 169, null);
					this.getGraphics2D().flush(true);
				}
				break;
			case SKILLS:
				if (isSkillTabClicked) {
					final Image skillsRedStone = tabArea.getTabs()[1].getImage();
					this.getGraphics2D().drawImage(skillsRedStone, 569, 168, null);
					this.getGraphics2D().flush(true);
				}
				break;
			case QUEST:
				if (isQuestTabClicked) {
					final Image questRedStone = tabArea.getTabs()[2].getImage();
					this.getGraphics2D().drawImage(questRedStone, 597, 168, null);
					this.getGraphics2D().flush(true);
				}
			case INVENTORY:
				if (isInventoryTabClicked) {
					final Image inventoryRedStone = tabArea.getTabs()[3].getImage();
					this.getGraphics2D().drawImage(inventoryRedStone, 625, 168, null);
					this.getGraphics2D().flush(true);
				}
				break;
			case ARMOUR:
				if (isArmourTabClicked) {
					final Image armourRedStone = tabArea.getTabs()[4].getImage();
					this.getGraphics2D().drawImage(armourRedStone, 666, 168, null);
					this.getGraphics2D().flush(true);
				}
				break;
			case PRAYER:
				if (isPrayerTabClicked) {
					final Image prayerRedStone = tabArea.getTabs()[5].getImage();
					this.getGraphics2D().drawImage(prayerRedStone, 694, 168, null);
					this.getGraphics2D().flush(true);
				}
				break;
			case MAGIC:
				if (isMagicTabClicked) {
					final Image magicRedStone = tabArea.getTabs()[6].getImage();
					this.getGraphics2D().drawImage(magicRedStone, 722, 169, null);
					this.getGraphics2D().flush(true);
				}
				break;
			case OTHER:
				if (isOtherTabClicked) {
					final Image otherRedStone = tabArea.getTabs()[7].getImage();
					this.getGraphics2D().drawImage(otherRedStone, 540, 466, null);
					this.getGraphics2D().flush(true);
				}
				break;
			case FRIENDS:
				if (isFriendTabClicked) {
					final Image friendsRedStone = tabArea.getTabs()[8].getImage();
					this.getGraphics2D().drawImage(friendsRedStone, 572, 466, null);
					this.getGraphics2D().flush(true);
				}
				break;
			case IGNORE:
				if (isIgnoreTabClicked) {
					final Image ignoreRedStone = tabArea.getTabs()[9].getImage();
					this.getGraphics2D().drawImage(ignoreRedStone, 599, 466, null);
					this.getGraphics2D().flush(true);
				}
				break;
			case LOGOUT:
				if (isLogoutTabClicked) {
					final Image logoutRedStone = tabArea.getTabs()[10].getImage();
					this.getGraphics2D().drawImage(logoutRedStone, 627, 467, null);
					this.getGraphics2D().flush(true);
				}
				break;
			case SETTINGS:
				if (isSettingsTabClicked) {
					final Image settingsRedStone = tabArea.getTabs()[11].getImage();
					this.getGraphics2D().drawImage(settingsRedStone, 669, 466, null);
					this.getGraphics2D().flush(true);
				}
				break;
			case RUN:
				if (isRunTabClicked) {
					final Image runRedStone = tabArea.getTabs()[12].getImage();
					this.getGraphics2D().drawImage(runRedStone, 696, 466, null);
					this.getGraphics2D().flush(true);
				}
				break;
			case MUSIC:
				if (isMusicTabClicked) {
					final Image musicRedStone = tabArea.getTabs()[13].getImage();
					this.getGraphics2D().drawImage(musicRedStone, 724, 466, null);
					this.getGraphics2D().flush(true);
				}
				break;
			}
			this.getGraphics2D().flush(true);
			break;
		case RIGHT_CLICK:
			final Menu menu = new Menu(clickedX, clickedY, null);
			final Image image = menu.getImage();
			this.getGraphics2D().drawImage(image, clickedX, clickedY, null);
			this.getGraphics2D().flush(true);
			break;
		case HOVER:
			if (isChatBoxHovered) {
				this.getGraphics2D().setColor(Color.WHITE);
				this.getGraphics2D().drawString("ChatArea", 10, 20);
				this.getGraphics2D().flush(true);
			} else if (isTabAreaHovered) {
				this.getGraphics2D().setColor(Color.WHITE);
				this.getGraphics2D().drawString("TabArea", 10, 20);
				this.getGraphics2D().flush(true);
			} else if (isMapAreaHovered) {
				this.getGraphics2D().setColor(Color.WHITE);
				this.getGraphics2D().drawString("MapArea", 10, 20);
				this.getGraphics2D().flush(true);
			}
			/** final StringBuilder xStringBuilder = new StringBuilder("X: ");
			xStringBuilder.append(hoverX);
			final StringBuilder yStringBuilder = new StringBuilder("Y: ");
			yStringBuilder.append(hoverY);
			this.getGraphics2D().setColor(Color.WHITE);
			this.getGraphics2D().drawString(xStringBuilder.toString(), 10, 50);
			this.getGraphics2D().drawString(yStringBuilder.toString(), 10, 70);
			this.getGraphics2D().flush(true);
		}
	} */

	public void setChatBox(final ChatBox chatBox) {
		this.chatBox = chatBox;
	}

	public ChatBox getChatBox() {
		return this.chatBox;
	}

	public void setTabArea(final TabArea tabArea) {
		this.tabArea = tabArea;
	}

	public TabArea getTabArea() {
		return this.tabArea;
	}

	public void setCompass(final Compass compass) {
		this.compass = compass;
	}

	public Compass getCompass() {
		return this.compass;
	}

	public void setMapArea(final MapArea mapArea) {
		this.mapArea = mapArea;
	}

	public MapArea getMapArea() {
		return this.mapArea;
	}

	public void setPlayer(final GamePlayer player) {
		this.player = player;
	}

	public GamePlayer getPlayer() {
		return this.player;
	}

	public void setRunning(final boolean isRunning) {
		this.isRunning = isRunning;
	}

	public boolean isRunning() {
		return this.isRunning;
	}

	public void setMemory(final Memory memory) {
		this.memory = memory;
	}

	public Memory getMemory() {
		return this.memory;
	}

	public void setRevisionType(final RevisionType revisionType) {
		this.revisionType = revisionType;
	}

	public RevisionType getRevisionType() {
		return this.revisionType;
	}

	public void setGameFrame(final GameFrame gameFrame) {
		this.gameFrame = gameFrame;
	}

	public GameFrame getGameFrame() {
		return this.gameFrame;
	}

	public void setMale(final Male male) {
		this.male = male;
	}

	public Male getMale() {
		return this.male;
	}
}